<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Tutorial - Andy Auth Documentation</title>
    <meta name="description" content="JavaScript OAuth integration tutorial">
    <link rel="stylesheet" href="/docs/css/docs.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/docs/images/favicon.png">
</head>
<body>
    <header class="docs-header">
        <div class="docs-header-inner">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <button class="docs-mobile-toggle" id="sidebar-toggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <a href="/docs/" class="docs-logo">
                    <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="8" fill="currentColor"/>
                        <path d="M8 24V8h6l4 8 4-8h6v16h-5V14l-3.5 7h-3L13 14v10H8z" fill="white"/>
                    </svg>
                    <span class="docs-logo-text">
                        <span class="docs-logo-title">Andy Auth</span>
                        <span class="docs-logo-subtitle">Documentation</span>
                    </span>
                    <span class="docs-version">v1.0</span>
                </a>
            </div>

            <div class="docs-search">
                <div class="docs-search-wrapper">
                    <svg class="docs-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" class="docs-search-input" placeholder="Search documentation..." data-search-trigger readonly>
                    <span class="docs-search-shortcut">Ctrl K</span>
                </div>
            </div>

            <div class="docs-header-actions">
                <button class="docs-header-btn" id="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
                    </svg>
                </button>
                <a href="https://github.com/rivoli-ai/andy-auth" class="docs-header-btn" title="GitHub" target="_blank">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                </a>
                <a href="/" class="docs-header-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                    </svg>
                    <span>Back to App</span>
                </a>
            </div>
        </div>
    </header>

    <aside class="docs-sidebar">
        <nav>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">Getting Started</div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/" class="docs-sidebar-link">Overview</a></li>
                    <li><a href="/docs/quickstart.html" class="docs-sidebar-link">Quick Start</a></li>
                    <li><a href="/docs/installation.html" class="docs-sidebar-link">Installation</a></li>
                    <li><a href="/docs/configuration.html" class="docs-sidebar-link">Configuration</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">MCP Integration <span class="badge badge-new">Important</span></div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/mcp/overview.html" class="docs-sidebar-link">MCP Overview</a></li>
                    <li><a href="/docs/mcp/oauth-flow.html" class="docs-sidebar-link">OAuth 2.1 Flow</a></li>
                    <li><a href="/docs/mcp/claude-desktop.html" class="docs-sidebar-link">Claude Desktop</a></li>
                    <li><a href="/docs/mcp/chatgpt.html" class="docs-sidebar-link">ChatGPT</a></li>
                    <li><a href="/docs/mcp/vscode-extensions.html" class="docs-sidebar-link">VS Code Extensions</a></li>
                    <li><a href="/docs/mcp/dcr.html" class="docs-sidebar-link">Dynamic Client Registration</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">OAuth & OpenID Connect</div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/oauth/concepts.html" class="docs-sidebar-link">Core Concepts</a></li>
                    <li><a href="/docs/oauth/authorization-code.html" class="docs-sidebar-link">Authorization Code Flow</a></li>
                    <li><a href="/docs/oauth/pkce.html" class="docs-sidebar-link">PKCE</a></li>
                    <li><a href="/docs/oauth/client-credentials.html" class="docs-sidebar-link">Client Credentials</a></li>
                    <li><a href="/docs/oauth/access-tokens.html" class="docs-sidebar-link">Access Tokens</a></li>
                    <li><a href="/docs/oauth/refresh-tokens.html" class="docs-sidebar-link">Refresh Tokens</a></li>
                    <li><a href="/docs/oauth/scopes.html" class="docs-sidebar-link">Scopes</a></li>
                    <li><a href="/docs/oauth/claims.html" class="docs-sidebar-link">Claims</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">Tutorials</div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/tutorials/python.html" class="docs-sidebar-link">Python</a></li>
                    <li><a href="/docs/tutorials/csharp.html" class="docs-sidebar-link">C# / .NET</a></li>
                    <li><a href="/docs/tutorials/javascript.html" class="docs-sidebar-link active">JavaScript</a></li>
                    <li><a href="/docs/tutorials/typescript.html" class="docs-sidebar-link">TypeScript</a></li>
                    <li><a href="/docs/tutorials/java.html" class="docs-sidebar-link">Java</a></li>
                    <li><a href="/docs/tutorials/go.html" class="docs-sidebar-link">Go</a></li>
                    <li><a href="/docs/tutorials/rust.html" class="docs-sidebar-link">Rust</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">API Reference</div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/api/endpoints.html" class="docs-sidebar-link">Endpoints Overview</a></li>
                    <li><a href="/docs/api/authorize.html" class="docs-sidebar-link">Authorization</a></li>
                    <li><a href="/docs/api/token.html" class="docs-sidebar-link">Token</a></li>
                    <li><a href="/docs/api/userinfo.html" class="docs-sidebar-link">UserInfo</a></li>
                    <li><a href="/docs/api/introspect.html" class="docs-sidebar-link">Introspection</a></li>
                    <li><a href="/docs/api/revoke.html" class="docs-sidebar-link">Revocation</a></li>
                    <li><a href="/docs/api/register.html" class="docs-sidebar-link">Client Registration</a></li>
                    <li><a href="/docs/api/discovery.html" class="docs-sidebar-link">Discovery</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">Admin Dashboard <span class="badge badge-new">New</span></div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/admin/dashboard.html" class="docs-sidebar-link">Dashboard</a></li>
                    <li><a href="/docs/admin/users.html" class="docs-sidebar-link">Users</a></li>
                    <li><a href="/docs/admin/clients.html" class="docs-sidebar-link">Clients</a></li>
                    <li><a href="/docs/admin/tokens.html" class="docs-sidebar-link">Tokens</a></li>
                    <li><a href="/docs/admin/audit-logs.html" class="docs-sidebar-link">Audit Logs</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">Deployment</div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/deployment/railway.html" class="docs-sidebar-link">Railway</a></li>
                    <li><a href="/docs/deployment/docker.html" class="docs-sidebar-link">Docker</a></li>
                    <li><a href="/docs/deployment/production.html" class="docs-sidebar-link">Production</a></li>
                    <li><a href="/docs/deployment/azure.html" class="docs-sidebar-link">Azure</a></li>
                </ul>
            </div>
            <div class="docs-sidebar-section">
                <div class="docs-sidebar-title">Security</div>
                <ul class="docs-sidebar-nav">
                    <li><a href="/docs/security/overview.html" class="docs-sidebar-link">Security Overview</a></li>
                </ul>
            </div>
        </nav>
    </aside>

        <main class="docs-main">
            <article class="docs-content">
                <div class="docs-breadcrumb">
                    <a href="../">Docs</a>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                    <a href="#">Tutorials</a>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                    <span>JavaScript</span>
                </div>

                <h1>JavaScript OAuth Integration</h1>
                <p class="docs-lead">Integrate Andy Auth into your JavaScript applications using Node.js, Express, or browser-based SPAs.</p>

                <h2 id="node-express">Node.js with Express</h2>
                <p>A complete Express.js application with OAuth authentication:</p>

                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">JavaScript - server.js</span>
                        <button class="code-block-copy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                                Copy
                            </button>
                    </div>
                    <pre><code class="language-javascript">const express = require('express');
const session = require('express-session');
const crypto = require('crypto');

const app = express();

// Configuration
const config = {
    authority: 'https://your-andy-auth-server.com',
    clientId: 'your-client-id',
    clientSecret: 'your-client-secret',
    redirectUri: 'http://localhost:3000/callback',
    scopes: ['openid', 'profile', 'email']
};

// Session middleware
app.use(session({
    secret: crypto.randomBytes(32).toString('hex'),
    resave: false,
    saveUninitialized: false,
    cookie: { secure: process.env.NODE_ENV === 'production' }
}));

// PKCE Helper functions
function generateCodeVerifier() {
    return crypto.randomBytes(32).toString('base64url');
}

function generateCodeChallenge(verifier) {
    return crypto.createHash('sha256')
        .update(verifier)
        .digest('base64url');
}

// Home page
app.get('/', (req, res) => {
    if (req.session.user) {
        res.send(`
            &lt;h1&gt;Welcome ${req.session.user.name}&lt;/h1&gt;
            &lt;p&gt;Email: ${req.session.user.email}&lt;/p&gt;
            &lt;a href="/logout"&gt;Logout&lt;/a&gt;
        `);
    } else {
        res.send(`
            &lt;h1&gt;Andy Auth Demo&lt;/h1&gt;
            &lt;a href="/login"&gt;Login with Andy Auth&lt;/a&gt;
        `);
    }
});

// Start OAuth flow
app.get('/login', (req, res) => {
    const state = crypto.randomBytes(16).toString('hex');
    const codeVerifier = generateCodeVerifier();
    const codeChallenge = generateCodeChallenge(codeVerifier);

    // Store in session for callback verification
    req.session.oauth = { state, codeVerifier };

    const authUrl = new URL(`${config.authority}/connect/authorize`);
    authUrl.searchParams.set('client_id', config.clientId);
    authUrl.searchParams.set('redirect_uri', config.redirectUri);
    authUrl.searchParams.set('response_type', 'code');
    authUrl.searchParams.set('scope', config.scopes.join(' '));
    authUrl.searchParams.set('state', state);
    authUrl.searchParams.set('code_challenge', codeChallenge);
    authUrl.searchParams.set('code_challenge_method', 'S256');

    res.redirect(authUrl.toString());
});

// OAuth callback
app.get('/callback', async (req, res) => {
    const { code, state, error } = req.query;

    if (error) {
        return res.status(400).send(`OAuth error: ${error}`);
    }

    // Verify state
    if (state !== req.session.oauth?.state) {
        return res.status(400).send('Invalid state parameter');
    }

    try {
        // Exchange code for tokens
        const tokenResponse = await fetch(`${config.authority}/connect/token`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
                grant_type: 'authorization_code',
                code,
                redirect_uri: config.redirectUri,
                client_id: config.clientId,
                client_secret: config.clientSecret,
                code_verifier: req.session.oauth.codeVerifier
            })
        });

        if (!tokenResponse.ok) {
            throw new Error(`Token exchange failed: ${await tokenResponse.text()}`);
        }

        const tokens = await tokenResponse.json();

        // Get user info
        const userInfoResponse = await fetch(`${config.authority}/connect/userinfo`, {
            headers: { Authorization: `Bearer ${tokens.access_token}` }
        });

        const userInfo = await userInfoResponse.json();

        // Store in session
        req.session.user = userInfo;
        req.session.tokens = tokens;
        delete req.session.oauth;

        res.redirect('/');
    } catch (err) {
        console.error('Callback error:', err);
        res.status(500).send('Authentication failed');
    }
});

// Logout
app.get('/logout', (req, res) => {
    req.session.destroy();
    res.redirect('/');
});

// Protected API endpoint
app.get('/api/profile', (req, res) => {
    if (!req.session.user) {
        return res.status(401).json({ error: 'Not authenticated' });
    }
    res.json(req.session.user);
});

app.listen(3000, () => {
    console.log('Server running on http://localhost:3000');
});</code></pre>
                </div>

                <h2 id="spa">Browser Single Page Application</h2>
                <p>OAuth implementation for SPAs using the authorization code flow with PKCE:</p>

                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">JavaScript - auth.js</span>
                        <button class="code-block-copy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                                Copy
                            </button>
                    </div>
                    <pre><code class="language-javascript">class AndyAuthClient {
    constructor(config) {
        this.authority = config.authority;
        this.clientId = config.clientId;
        this.redirectUri = config.redirectUri;
        this.scopes = config.scopes || ['openid', 'profile', 'email'];
        this.storageKey = 'andy_auth_tokens';
    }

    // Generate PKCE code verifier
    generateCodeVerifier() {
        const array = new Uint8Array(32);
        crypto.getRandomValues(array);
        return this.base64UrlEncode(array);
    }

    // Generate code challenge from verifier
    async generateCodeChallenge(verifier) {
        const encoder = new TextEncoder();
        const data = encoder.encode(verifier);
        const hash = await crypto.subtle.digest('SHA-256', data);
        return this.base64UrlEncode(new Uint8Array(hash));
    }

    base64UrlEncode(buffer) {
        return btoa(String.fromCharCode(...buffer))
            .replace(/\+/g, '-')
            .replace(/\//g, '_')
            .replace(/=/g, '');
    }

    // Start login flow
    async login() {
        const state = this.generateCodeVerifier().substring(0, 16);
        const codeVerifier = this.generateCodeVerifier();
        const codeChallenge = await this.generateCodeChallenge(codeVerifier);

        // Store PKCE data
        sessionStorage.setItem('oauth_state', state);
        sessionStorage.setItem('code_verifier', codeVerifier);

        const authUrl = new URL(`${this.authority}/connect/authorize`);
        authUrl.searchParams.set('client_id', this.clientId);
        authUrl.searchParams.set('redirect_uri', this.redirectUri);
        authUrl.searchParams.set('response_type', 'code');
        authUrl.searchParams.set('scope', this.scopes.join(' '));
        authUrl.searchParams.set('state', state);
        authUrl.searchParams.set('code_challenge', codeChallenge);
        authUrl.searchParams.set('code_challenge_method', 'S256');

        window.location.href = authUrl.toString();
    }

    // Handle callback after redirect
    async handleCallback() {
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        const state = params.get('state');
        const error = params.get('error');

        if (error) {
            throw new Error(`OAuth error: ${error}`);
        }

        // Verify state
        const savedState = sessionStorage.getItem('oauth_state');
        if (state !== savedState) {
            throw new Error('Invalid state parameter');
        }

        const codeVerifier = sessionStorage.getItem('code_verifier');

        // Exchange code for tokens
        const response = await fetch(`${this.authority}/connect/token`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
                grant_type: 'authorization_code',
                code,
                redirect_uri: this.redirectUri,
                client_id: this.clientId,
                code_verifier: codeVerifier
            })
        });

        if (!response.ok) {
            throw new Error(`Token exchange failed: ${await response.text()}`);
        }

        const tokens = await response.json();
        this.saveTokens(tokens);

        // Clean up
        sessionStorage.removeItem('oauth_state');
        sessionStorage.removeItem('code_verifier');

        // Clean URL
        window.history.replaceState({}, '', window.location.pathname);

        return tokens;
    }

    saveTokens(tokens) {
        localStorage.setItem(this.storageKey, JSON.stringify({
            ...tokens,
            expires_at: Date.now() + (tokens.expires_in * 1000)
        }));
    }

    getTokens() {
        const data = localStorage.getItem(this.storageKey);
        return data ? JSON.parse(data) : null;
    }

    getAccessToken() {
        const tokens = this.getTokens();
        if (!tokens) return null;

        // Check expiration
        if (Date.now() >= tokens.expires_at) {
            this.logout();
            return null;
        }

        return tokens.access_token;
    }

    isAuthenticated() {
        return !!this.getAccessToken();
    }

    async getUserInfo() {
        const token = this.getAccessToken();
        if (!token) throw new Error('Not authenticated');

        const response = await fetch(`${this.authority}/connect/userinfo`, {
            headers: { Authorization: `Bearer ${token}` }
        });

        if (!response.ok) {
            throw new Error('Failed to get user info');
        }

        return response.json();
    }

    logout() {
        localStorage.removeItem(this.storageKey);
    }

    // Make authenticated API requests
    async fetch(url, options = {}) {
        const token = this.getAccessToken();
        if (!token) {
            throw new Error('Not authenticated');
        }

        return fetch(url, {
            ...options,
            headers: {
                ...options.headers,
                Authorization: `Bearer ${token}`
            }
        });
    }
}

// Usage
const auth = new AndyAuthClient({
    authority: 'https://your-andy-auth-server.com',
    clientId: 'spa-client',
    redirectUri: 'http://localhost:3000/callback'
});

// Check for callback
if (window.location.search.includes('code=')) {
    auth.handleCallback()
        .then(() => console.log('Logged in!'))
        .catch(err => console.error('Login failed:', err));
}

// Login button
document.getElementById('login-btn')?.addEventListener('click', () => {
    auth.login();
});

// Get user info
if (auth.isAuthenticated()) {
    auth.getUserInfo().then(user => {
        console.log('User:', user);
    });
}</code></pre>
                </div>

                <h2 id="react">React Integration</h2>
                <p>React hooks for authentication state management:</p>

                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">JavaScript - useAuth.js</span>
                        <button class="code-block-copy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                                Copy
                            </button>
                    </div>
                    <pre><code class="language-javascript">import { createContext, useContext, useState, useEffect, useCallback } from 'react';

const AuthContext = createContext(null);

export function AuthProvider({ children, config }) {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    const auth = useMemo(() => new AndyAuthClient(config), [config]);

    useEffect(() => {
        // Check for callback on mount
        if (window.location.search.includes('code=')) {
            auth.handleCallback()
                .then(() => loadUser())
                .catch(err => setError(err.message))
                .finally(() => setLoading(false));
        } else if (auth.isAuthenticated()) {
            loadUser();
        } else {
            setLoading(false);
        }
    }, []);

    const loadUser = useCallback(async () => {
        try {
            const userInfo = await auth.getUserInfo();
            setUser(userInfo);
        } catch (err) {
            setError(err.message);
            auth.logout();
        } finally {
            setLoading(false);
        }
    }, [auth]);

    const login = useCallback(() => {
        auth.login();
    }, [auth]);

    const logout = useCallback(() => {
        auth.logout();
        setUser(null);
    }, [auth]);

    const value = {
        user,
        loading,
        error,
        isAuthenticated: !!user,
        login,
        logout,
        getAccessToken: () => auth.getAccessToken()
    };

    return (
        &lt;AuthContext.Provider value={value}&gt;
            {children}
        &lt;/AuthContext.Provider&gt;
    );
}

export function useAuth() {
    const context = useContext(AuthContext);
    if (!context) {
        throw new Error('useAuth must be used within AuthProvider');
    }
    return context;
}

// Protected route component
export function ProtectedRoute({ children }) {
    const { isAuthenticated, loading, login } = useAuth();

    if (loading) {
        return &lt;div&gt;Loading...&lt;/div&gt;;
    }

    if (!isAuthenticated) {
        return (
            &lt;div&gt;
                &lt;p&gt;Please log in to access this page&lt;/p&gt;
                &lt;button onClick={login}&gt;Login&lt;/button&gt;
            &lt;/div&gt;
        );
    }

    return children;
}

// Usage in App.js
function App() {
    return (
        &lt;AuthProvider config={{
            authority: 'https://your-andy-auth-server.com',
            clientId: 'react-app',
            redirectUri: window.location.origin + '/callback'
        }}&gt;
            &lt;Router&gt;
                &lt;Routes&gt;
                    &lt;Route path="/" element={&lt;Home /&gt;} /&gt;
                    &lt;Route path="/callback" element={&lt;Callback /&gt;} /&gt;
                    &lt;Route path="/profile" element={
                        &lt;ProtectedRoute&gt;
                            &lt;Profile /&gt;
                        &lt;/ProtectedRoute&gt;
                    } /&gt;
                &lt;/Routes&gt;
            &lt;/Router&gt;
        &lt;/AuthProvider&gt;
    );
}</code></pre>
                </div>

                <h2 id="mcp-server">MCP Server in Node.js</h2>
                <p>Build an MCP-compatible server that validates OAuth tokens:</p>

                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">JavaScript - mcp-server.js</span>
                        <button class="code-block-copy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                                Copy
                            </button>
                    </div>
                    <pre><code class="language-javascript">const express = require('express');
const jwt = require('jsonwebtoken');
const jwksClient = require('jwks-rsa');

const app = express();
app.use(express.json());

const config = {
    authority: 'https://your-andy-auth-server.com',
    audience: 'mcp-server'
};

// JWKS client for token validation
const client = jwksClient({
    jwksUri: `${config.authority}/.well-known/openid-configuration/jwks`,
    cache: true,
    rateLimit: true
});

function getKey(header, callback) {
    client.getSigningKey(header.kid, (err, key) => {
        if (err) return callback(err);
        callback(null, key.getPublicKey());
    });
}

// Token validation middleware
function validateToken(req, res, next) {
    const authHeader = req.headers.authorization;
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
        return res.status(401).json({ error: 'Missing or invalid authorization header' });
    }

    const token = authHeader.substring(7);

    jwt.verify(token, getKey, {
        issuer: config.authority,
        audience: config.audience
    }, (err, decoded) => {
        if (err) {
            console.error('Token validation failed:', err.message);
            return res.status(401).json({ error: 'Invalid token' });
        }
        req.user = decoded;
        next();
    });
}

// MCP tool: Get current user
app.post('/mcp/tools/get_user', validateToken, (req, res) => {
    res.json({
        tool: 'get_user',
        result: {
            userId: req.user.sub,
            email: req.user.email,
            name: req.user.name
        }
    });
});

// MCP tool: Query data
app.post('/mcp/tools/query', validateToken, async (req, res) => {
    const { query } = req.body;

    // Check scope
    const scopes = req.user.scope?.split(' ') || [];
    if (!scopes.includes('data:read')) {
        return res.status(403).json({ error: 'Insufficient permissions' });
    }

    // Execute query (example)
    const result = { data: 'Example result for: ' + query };

    res.json({
        tool: 'query',
        result
    });
});

// MCP tool discovery endpoint
app.get('/mcp/tools', validateToken, (req, res) => {
    res.json({
        tools: [
            {
                name: 'get_user',
                description: 'Get information about the authenticated user',
                input_schema: {
                    type: 'object',
                    properties: {},
                    required: []
                }
            },
            {
                name: 'query',
                description: 'Query data from the system',
                input_schema: {
                    type: 'object',
                    properties: {
                        query: {
                            type: 'string',
                            description: 'The query to execute'
                        }
                    },
                    required: ['query']
                }
            }
        ]
    });
});

app.listen(3001, () => {
    console.log('MCP Server running on http://localhost:3001');
});</code></pre>
                </div>

                <h2 id="vue">Vue.js Integration</h2>
                <p>Vue 3 composable for authentication:</p>

                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">JavaScript - useAuth.js (Vue)</span>
                        <button class="code-block-copy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                                Copy
                            </button>
                    </div>
                    <pre><code class="language-javascript">import { ref, computed, onMounted } from 'vue';

const user = ref(null);
const loading = ref(true);
const error = ref(null);

let authClient = null;

export function createAuth(config) {
    authClient = new AndyAuthClient(config);
}

export function useAuth() {
    const isAuthenticated = computed(() => !!user.value);

    onMounted(async () => {
        if (!authClient) {
            throw new Error('Auth not initialized. Call createAuth first.');
        }

        // Handle callback
        if (window.location.search.includes('code=')) {
            try {
                await authClient.handleCallback();
                const userInfo = await authClient.getUserInfo();
                user.value = userInfo;
            } catch (err) {
                error.value = err.message;
            }
        } else if (authClient.isAuthenticated()) {
            try {
                const userInfo = await authClient.getUserInfo();
                user.value = userInfo;
            } catch (err) {
                authClient.logout();
            }
        }

        loading.value = false;
    });

    function login() {
        authClient.login();
    }

    function logout() {
        authClient.logout();
        user.value = null;
    }

    function getAccessToken() {
        return authClient.getAccessToken();
    }

    return {
        user,
        loading,
        error,
        isAuthenticated,
        login,
        logout,
        getAccessToken
    };
}

// main.js
import { createApp } from 'vue';
import App from './App.vue';
import { createAuth } from './composables/useAuth';

createAuth({
    authority: 'https://your-andy-auth-server.com',
    clientId: 'vue-app',
    redirectUri: window.location.origin + '/callback'
});

createApp(App).mount('#app');</code></pre>
                </div>

                <div class="docs-callout docs-callout-warning">
                    <div class="docs-callout-title">Security Note for SPAs</div>
                    <p>Single Page Applications are public clients and cannot securely store client secrets. Always use PKCE and consider token rotation strategies for enhanced security.</p>
                </div>

                <div class="docs-callout docs-callout-success">
                    <div class="docs-callout-title">Next Steps</div>
                    <ul>
                        <li>Check out the <a href="typescript.html">TypeScript Tutorial</a> for type-safe implementations</li>
                        <li>Learn about <a href="../mcp/overview.html">MCP Integration</a> for AI assistants</li>
                        <li>Review <a href="../security/best-practices.html">Security Best Practices</a></li>
                    </ul>
                </div>
            </article>

            <aside class="docs-toc">
                <div class="docs-toc-title">On this page</div>
                <ul class="docs-toc-list"></ul>
            </aside>
        </main>

    <!-- Search Modal -->
    <div class="docs-search-modal" id="search-modal">
        <div class="docs-search-modal-content">
            <input type="text" id="search-modal-input" placeholder="Search documentation..." class="docs-search-modal-input">
            <div id="search-results" class="docs-search-results"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-docker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-http.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="/docs/js/docs.js"></script>
</body>
</html>
